<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cozy Parkour Plus</title>

<style>
body {
    margin: 0;
    overflow: hidden;
    background: #cfe8e4;
    font-family: "Quicksand", sans-serif;
}

/* Game canvas */
canvas {
    display: block;
    touch-action: none;
}

/* UI overlays */
#menu, #pause {
    position: fixed;
    inset: 0;
    background: #00000060;
    backdrop-filter: blur(8px);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    color: white;
    font-size: 32px;
}

/* Buttons */
.btn {
    background: #ffffffaa;
    padding: 12px 24px;
    border-radius: 12px;
    font-size: 24px;
    margin-top: 20px;
}

/* Touch controls */
#touchControls {
    position: fixed;
    bottom: 20px;
    left: 50%;
    width: 90%;
    transform: translateX(-50%);
    display: flex;
    justify-content: space-between;
    pointer-events: none;
}

.controlPad {
    pointer-events: auto;
    display: flex;
    gap: 10px;
}

.btnRound {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    background: #ffffff88;
    backdrop-filter: blur(6px);
    border: 2px solid #ffffff55;
    font-size: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    user-select: none;
}
</style>
</head>
<body>

<!-- GAME CANVAS -->
<canvas id="game" width="900" height="500"></canvas>

<!-- MAIN MENU -->
<div id="menu">
    <div>ðŸŒ¿ Cozy Parkour Plus</div>
    <div class="btn" id="startBtn">Start</div>
</div>

<!-- PAUSE MENU -->
<div id="pause" style="display:none">
    <div>Paused</div>
    <div class="btn" id="resumeBtn">Resume</div>
</div>

<!-- TOUCH CONTROLS -->
<div id="touchControls" style="display:none">
    <div class="controlPad">
        <div class="btnRound" id="leftBtn">âŸµ</div>
        <div class="btnRound" id="rightBtn">âŸ¶</div>
    </div>
    <div class="controlPad">
        <div class="btnRound" id="jumpBtn">â¬†</div>
        <div class="btnRound" id="dashBtn">âš¡</div>
    </div>
</div>

<!-- AUDIO -->
<audio id="bgm" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_9c39c2a63a.mp3?filename=lofi-study-112191.mp3" loop></audio>
<audio id="jumpS" src="https://cdn.pixabay.com/download/audio/2021/08/09/audio_7f8d0cb0fd.mp3?filename=jump-110270.mp3"></audio>
<audio id="landS" src="https://cdn.pixabay.com/download/audio/2022/02/23/audio_328f8c9230.mp3?filename=soft-thud-amp-dust-7091.mp3"></audio>
<audio id="coinS" src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_5f9e3cd908.mp3?filename=collectcoin-110181.mp3"></audio>
<audio id="dashS" src="https://cdn.pixabay.com/download/audio/2021/09/07/audio_6e7fb53986.mp3?filename=wind-effect-ambient-114463.mp3"></audio>

<script>
/* ================================
   GAME BASE
================================ */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let gameRunning = false;
let paused = false;

const keys = { left: false, right: false, jump: false, dash: false };

const gravity = 0.45;
const dashPower = 10;

let fireflies = [];

/* ================================
   PLAYER
================================ */
const player = {
    x: 50, y: 350,
    w: 36, h: 36,
    dx: 0, dy: 0,
    speed: 4,
    jumps: 0,
    maxJumps: 2,
    canDash: true,
    facing: 1
};

/* ================================
   LEVELS
================================ */
let levelIndex = 0;
const levels = [
{
    platforms: [
        {x:0,y:450,w:900,h:40},
        {x:150,y:360,w:150,h:20},
        {x:350,y:300,w:180,h:20},
        {x:600,y:260,w:180,h:20},
        {x:750,y:400,w:120,h:20}
    ],
    coins: [
        {x:180,y:320,taken:false},
        {x:380,y:260,taken:false},
        {x:650,y:220,taken:false}
    ],
    end: {x:840,y:410,w:30,h:30}
},
{
    platforms: [
        {x:0,y:450,w:900,h:40},
        {x:200,y:380,w:120,h:20},
        {x:350,y:330,w:140,h:20},
        {x:520,y:280,w:140,h:20},
        {x:700,y:330,w:160,h:20},
    ],
    coins: [
        {x:220,y:340,taken:false},
        {x:370,y:290,taken:false},
        {x:540,y:240,taken:false},
        {x:730,y:290,taken:false}
    ],
    end: {x:820,y:410,w:30,h:30}
}
];

/* ================================
   INPUT
================================ */
document.addEventListener("keydown", e => {
    if (e.key==="ArrowLeft") keys.left = true;
    if (e.key==="ArrowRight") keys.right = true;
    if (e.key==="ArrowUp") keys.jump = true;
    if (e.key==="Shift") keys.dash = true;
    if (e.key==="Escape") togglePause();
});
document.addEventListener("keyup", e => {
    if (e.key==="ArrowLeft") keys.left = false;
    if (e.key==="ArrowRight") keys.right = false;
    if (e.key==="ArrowUp") keys.jump = false;
    if (e.key==="Shift") keys.dash = false;
});

/* TOUCH */
function bindTouch(id, key) {
    const btn = document.getElementById(id);
    btn.ontouchstart = () => keys[key] = true;
    btn.ontouchend = () => keys[key] = false;
}
bindTouch("leftBtn","left");
bindTouch("rightBtn","right");
bindTouch("jumpBtn","jump");
bindTouch("dashBtn","dash");

/* ================================
   GAME LOOP
================================ */
function update(){
    if (!gameRunning || paused) return;

    const lvl = levels[levelIndex];

    // Movement
    player.dx = 0;
    if (keys.left) { player.dx = -player.speed; player.facing = -1; }
    if (keys.right){ player.dx = player.speed;  player.facing = 1; }

    // Jump
    if (keys.jump && player.jumps < player.maxJumps){
        player.dy = -9;
        player.jumps++;
        jumpS.currentTime = 0;
        jumpS.play();
        keys.jump = false;
    }

    // Dash
    if (keys.dash && player.canDash){
        player.dx = dashPower * player.facing;
        player.canDash = false;
        dashS.currentTime = 0;
        dashS.play();
        keys.dash = false;
    }

    // Gravity
    player.dy += gravity;

    // Move
    player.x += player.dx;
    player.y += player.dy;

    // Platform collisions
    let landing = false;
    for (let p of lvl.platforms){
        if (player.x < p.x + p.w &&
            player.x + player.w > p.x &&
            player.y + player.h > p.y &&
            player.y + player.h < p.y + p.h + player.dy)
        {
            player.y = p.y - player.h;
            player.dy = 0;
            player.jumps = 0;
            player.canDash = true;

            if (Math.abs(player.dy) > 3) {
                landS.currentTime = 0;
                landS.play();
            }
            landing = true;
        }
    }

    // Coins
    for (let c of lvl.coins){
        if (!c.taken &&
            player.x < c.x+20 && player.x+player.w > c.x &&
            player.y < c.y+20 && player.y+player.h > c.y)
        {
            c.taken = true;
            coinS.currentTime = 0;
            coinS.play();
        }
    }

    // End goal
    const e = lvl.end;
    if (player.x < e.x+e.w && player.x+player.w > e.x &&
        player.y < e.y+e.h && player.y+player.h > e.y)
    {
        nextLevel();
    }

    draw();
    requestAnimationFrame(update);
}

function draw(){
    const lvl = levels[levelIndex];

    ctx.clearRect(0,0,canvas.width,canvas.height);

    /* Background */
    ctx.fillStyle = "#cfe8e4";
    ctx.fillRect(0,0,900,500);

    // Parallax layers
    ctx.fillStyle = "#b7d3cf";
    ctx.fillRect(0,350,900,150); // ground haze

    // Fireflies
    ctx.fillStyle = "#fffbcc";
    for (let f of fireflies){
        f.x += Math.sin(f.t)/20;
        f.y += Math.cos(f.t)/35;
        f.t += 0.02;
        ctx.beginPath();
        ctx.arc(f.x,f.y,2,0,Math.PI*2);
        ctx.fill();
    }

    // Platforms
    ctx.fillStyle = "#a7c7a9";
    lvl.platforms.forEach(p=>{
        ctx.fillRect(p.x,p.y,p.w,p.h);
    });

    // Coins
    ctx.fillStyle = "#ffe29a";
    lvl.coins.forEach(c=>{
        if (!c.taken) ctx.fillRect(c.x,c.y,20,20);
    });

    // End flag
    ctx.fillStyle = "#ffd1d1";
    ctx.fillRect(lvl.end.x,lvl.end.y,lvl.end.w,lvl.end.h);

    // Player
    ctx.fillStyle = "#ffbfbf";
    ctx.fillRect(player.x,player.y,player.w,player.h);
}

/* ================================
   LEVEL CONTROL
================================ */
function startGame(){
    document.getElementById("menu").style.display = "none";
    document.getElementById("touchControls").style.display = "flex";

    bgm.volume = 0.4;
    bgm.play().catch(()=>{});

    gameRunning = true;
    generateFireflies();
    update();
}

function nextLevel(){
    levelIndex++;
    if (levelIndex >= levels.length) levelIndex = 0;

    // Reset player
    player.x = 50;
    player.y = 350;
    player.dy = 0;
    player.dx = 0;
}

function togglePause(){
    if (!gameRunning) return;
    paused = !paused;
    document.getElementById("pause").style.display = paused ? "flex" : "none";
    if (!paused) update();
}

/* ================================
   FIREFLIES
================================ */
function generateFireflies(){
    fireflies = [];
    for (let i=0;i<50;i++){
        fireflies.push({
            x: Math.random()*900,
            y: Math.random()*500,
            t: Math.random()*Math.PI
        });
    }
}

/* ================================
   UI BUTTONS
================================ */
document.getElementById("startBtn").onclick = startGame;
document.getElementById("resumeBtn").onclick = togglePause;

</script>
</body>
</html>
